---
title: Data Gathering
jupyter: python3
---

In order to understand long covid, I will be gathering data from a multitude of sources.

## Record data from CDC - Long Covid: 

The CDC released the results of a Household Pulse Survey, where they records results of post covid-19 symptoms across multiple demographics including age, sex, gender, and location. These survey results were recorded over a period of time. Using the open SODA API and the integration in R via *RSocrata*, I was able to obtain this data. A sample of the raw dataset is show below. 

```{r}
#| code-fold: true
library(RSocrata)
cdc <- read.socrata('https://data.cdc.gov/resource/gsea-w83j.csv')
head(cdc)
write.csv(cdc, 'cdc_raw.csv', row.names = FALSE)
```

![CDC Survey Data](images/cdc_raw_data.png){width=70% fig-align='center'}

## Long Covid Symptoms in UK 
The COVID-19 and Respiratory Infections Survey (CRIS) was used to obtain self-reported persisting symptoms of long covid within the UK. This dataset was downloaded from the Office of National Statistics (UK). 

[Click here to view the source](https://www.ons.gov.uk/peoplepopulationandcommunity/healthandsocialcare/conditionsanddiseases/datasets/selfreportedlongcovidsymptomsuk)

```{r}
#| output: false
#| echo: false
library(tidyverse)
library(readxl)

long_covid_uk_health <- read_excel("../../data/00-raw-data/longcovid_uk.xlsx", sheet = 6)
long_covid_uk_job <- read_excel("../../data/00-raw-data/longcovid_uk.xlsx", sheet = 7)
```

![UK Long Covid Survey Data Based on Health](images/uk_raw_data.png){width=70% fig-align='center'}

## News API:

Using the NewsAPI, I will extract media coverage with the key phrase "long covid" for the past month. 

```{python}
#| echo: false
API_KEY = '8491eeb10bba463a9665a53da25b1c69'
```

```{python}
#| code-fold: true
#| output: false
from newsapi import NewsApiClient
import pandas as pd
from datetime import date
from dateutil.relativedelta import relativedelta

date = date.today()
date_past = date - relativedelta(months=1)

# Init
newsapi = NewsApiClient(api_key= API_KEY)

sources = newsapi.get_sources()
sources = pd.DataFrame(sources['sources'])
sources = sources[(sources['language'] == 'en')]

df_sources = ', '.join(sources['id'].astype(str))
df_domains = ', '.join(sources['url'].astype(str))


# /v2/everything
all_articles = newsapi.get_everything(q='"long covid"',
                                      sources=str(df_sources),
                                      domains=str(df_domains),
                                      from_param= date_past,
                                      to= date,
                                      language= 'en',
                                      sort_by='relevancy')

long_covid_news = pd.DataFrame(all_articles['articles'])
long_covid_news[['id', 'name']] = pd.DataFrame(long_covid_news['source'].tolist())
long_covid_news.drop(columns=['source'], inplace=True)
long_covid_news = long_covid_news[['id','name','author','title','description','url','publishedAt','content']]


long_covid_news.to_csv('long_covid_news_raw.csv', index=False)

long_covid_news.head()
```

![News API Long Covid Data - Raw](images/news_raw_data.png){width=70%}

## White House perspective of Long Covid and necessary steps:
The White House released a statement regarding long covid as well as the nessesary steps to tackle the diagnosis. In order to understand the government's opinion of long covid, I will conduct a sentiment analysis on this statement. You can find the statement [here](https://www.whitehouse.gov/briefing-room/presidential-actions/2022/04/05/memorandum-on-addressing-the-long-term-effects-of-covid-19/). 

![The White House](images/white-house.png){width=50%}

